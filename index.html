<!-- Revised index.html with Google Drive API integration for shared photos -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Family Website</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    header { background: #333; color: #fff; padding: 1rem; text-align: center; }
    nav { background: #444; padding: 0.5rem; display: flex; gap: 1rem; justify-content: center; }
    nav a { color: #fff; text-decoration: none; padding: 0.5rem 1rem; background: #666; border-radius: 6px; }
    nav a:hover { background: #888; }
    section { padding: 1.5rem; }
    h2 { margin-top: 0; }
    .media-grid { display: grid; gap: 1rem; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
    .media-card { background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .media-card img, .media-card iframe { width: 100%; border-radius: 6px; }
    .btn { padding: 0.6rem 1rem; background: #333; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .comment { background: #fff; padding: 0.7rem; margin-bottom: 0.6rem; border-radius: 6px; }
    footer { text-align: center; padding: 1rem; background: #333; color: #fff; margin-top: 2rem; }
  </style>
</head>
<body>
  <header>
    <h1>Our Family Website</h1>
  </header>

  <nav>
    <a href="#photos">Photos</a>
    <a href="#videos">Videos</a>
    <a href="#comments">Comments</a>
  </nav>

  <!-- PHOTOS SECTION (Google Drive integrated) -->
  <section id="photos">
    <h2>Family Photo Gallery</h2>
    <p>Photos below load from our shared Google Drive folder.</p>

    <div style="margin-top:1rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
      <button id="driveAuthorize" class="btn">Sign in with Google</button>
      <button id="driveSignout" class="btn" style="display:none;">Sign out</button>
    </div>

    <input type="file" id="photoInput" accept="image/*" multiple style="margin-top:1rem;" />
    <button id="driveUpload" class="btn" disabled>Upload Selected Images</button>

    <h3 style="margin-top:2rem;">Shared Photos</h3>
    <div class="media-grid" id="photoGrid"></div>
  </section>

  <!-- VIDEOS SECTION -->
  <section id="videos">
    <h2>Family Videos</h2>
    <div class="media-card">
      <iframe src="https://www.youtube.com/embed/videoseries?list=PLF0dSSzU0Xsg-JhzeJfeTHygpNXBfZf79" allowfullscreen></iframe>
      <span>Family Playlist</span>
    </div>
  </section>

  <!-- COMMENTS SECTION -->
  <section id="comments">
    <h2>Comments</h2>
    <form id="commentForm">
      <input type="text" id="nameInput" placeholder="Your name" style="width:100%; padding:0.5rem; margin-bottom:0.5rem;" />
      <textarea id="messageInput" placeholder="Write a message..." style="width:100%; height:80px; padding:0.5rem;"></textarea>
      <button class="btn" type="submit" style="margin-top:0.5rem;">Post Comment</button>
    </form>

    <div id="commentList" style="margin-top:1rem;"></div>
  </section>

  <footer>&copy; <span id="year"></span> Our Family</footer>

  <!-- GOOGLE DRIVE PHOTO CODE -->
  <script>
    const CLIENT_ID = "220214661440-iqhbhncgbg34b6imeeha44pemj3pbf79.apps.googleusercontent.com";
    const API_KEY = "AIzaSyCn4WATS-73L4GlfdlEMP8XBNnz00Tw3-E";
    const FOLDER_ID = "1Ep4A7YqTfClYusea7NamuR1FKO6aW7HK";

    const DISCOVERY_DOC = "https://www.googleapis.com/discovery/v1/apis/drive/v3/rest";
    const SCOPES = "https://www.googleapis.com/auth/drive.file";

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;

    const authorizeButton = document.getElementById("driveAuthorize");
    const signoutButton = document.getElementById("driveSignout");
    const uploadButton = document.getElementById("driveUpload");
    const photoInput = document.getElementById("photoInput");
    const photoGrid = document.getElementById("photoGrid");

    document.getElementById("year").textContent = new Date().getFullYear();

    function gapiLoaded() { gapi.load("client", initializeGapiClient); }

    async function initializeGapiClient() {
      await gapi.client.init({ apiKey: API_KEY, discoveryDocs: [DISCOVERY_DOC] });
      gapiInited = true;
      maybeEnableAuthorize();
    }

    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: "",
      });
      gisInited = true;
      maybeEnableAuthorize();
    }

    function maybeEnableAuthorize() {
      if (gapiInited && gisInited) authorizeButton.style.display = "inline-block";
    }

    authorizeButton.onclick = () => {
      tokenClient.callback = async (resp) => {
        if (resp.error) return;
        authorizeButton.style.display = "none";
        signoutButton.style.display = "inline-block";
        uploadButton.disabled = false;
        listDriveImages();
      };

      if (gapi.client.getToken() === null) tokenClient.requestAccessToken({ prompt: "consent" });
      else tokenClient.requestAccessToken({ prompt: "" });
    };

    signoutButton.onclick = () => {
      const token = gapi.client.getToken();
      if (token) google.accounts.oauth2.revoke(token.access_token);
      gapi.client.setToken("");
      authorizeButton.style.display = "inline-block";
      signoutButton.style.display = "none";
      uploadButton.disabled = true;
      photoGrid.innerHTML = "";
    };

    uploadButton.onclick = async () => {
      const files = Array.from(photoInput.files || []);
      for (const file of files) await uploadFileToDrive(file);
      photoInput.value = "";
      listDriveImages();
    };

    async function uploadFileToDrive(file) {
      const boundary = "-------314159265358979323846";
      const delimiter = "\r\n--" + boundary + "\r\n";
      const closeDelim = "\r\n--" + boundary + "--";

      const metadata = { name: file.name, parents: [FOLDER_ID] };
      const reader = new FileReader();

      return new Promise((resolve, reject) => {
        reader.onload = async (e) => {
          const contentType = file.type;
          const base64Data = btoa(String.fromCharCode(...new Uint8Array(e.target.result)));

          const body =
            delimiter +
            "Content-Type: application/json\r\n\r\n" +
            JSON.stringify(metadata) +
            delimiter +
            "Content-Type: " + contentType + "\r\n" +
            "Content-Transfer-Encoding: base64\r\n\r\n" +
            base64Data +
            closeDelim;

          const response = await gapi.client.request({
            path: "/upload/drive/v3/files",
            method: "POST",
            params: { uploadType: "multipart" },
            headers: { "Content-Type": "multipart/related; boundary=" + boundary },
            body,
          });

          resolve(response.result);
        };
        reader.readAsArrayBuffer(file);
      });
    }

    async function listDriveImages() {
  photoGrid.innerHTML = "";
  try {
    const res = await gapi.client.drive.files.list({
      q: `'${FOLDER_ID}' in parents and trashed = false`,
      fields: "files(id, name, mimeType)",
      orderBy: "createdTime desc",
    });

    (res.result.files || [])
      .filter(f => f.mimeType && f.mimeType.startsWith("image/"))
      .forEach(file => {
        const card = document.createElement("div");
        card.className = "media-card";

        const img = document.createElement("img");
        img.src = `https://drive.google.com/uc?export=view&id=${file.id}`;
        img.alt = file.name;

        const caption = document.createElement("span");
        caption.textContent = file.name;

        card.appendChild(img);
        card.appendChild(caption);
        photoGrid.appendChild(card);
      });

  } catch (err) {
    console.error("Error listing Drive images:", err);
  }
}

  </script>

  <script src="https://accounts.google.com/gsi/client" async defer onload="gisLoaded()"></script>
  <script src="https://apis.google.com/js/api.js" async defer onload="gapiLoaded()"></script>

</body>
</html>
